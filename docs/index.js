var index=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function s(t){return"function"==typeof t}function a(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(e,n,o){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}function r(t,e){t.appendChild(e)}function u(t,e,n){t.insertBefore(e,n||null)}function l(t){t.parentNode.removeChild(t)}function i(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function f(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function m(){return d(" ")}function g(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function p(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function h(t){return""===t?null:+t}function x(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function $(t,e){t.value=null==e?"":e}function v(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e)return void(o.selected=!0)}t.selectedIndex=-1}function b(t,e,n){t.classList[n?"add":"remove"](e)}let k;function y(t){k=t}const _=[],q=[],C=[],L=[],F=Promise.resolve();let S=!1;function E(t){C.push(t)}function w(t){L.push(t)}const O=new Set;let A=0;function z(){const t=k;do{for(;A<_.length;){const t=_[A];A++,y(t),B(t.$$)}for(y(null),_.length=0,A=0;q.length;)q.pop()();for(let t=0;t<C.length;t+=1){const e=C[t];O.has(e)||(O.add(e),e())}C.length=0}while(_.length);for(;L.length;)L.pop()();S=!1,O.clear(),y(t)}function B(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(E)}}const D=new Set;function N(t,e){t&&t.i&&(D.delete(t),t.i(e))}function j(t,e,n,o){if(t&&t.o){if(D.has(t))return;D.add(t),undefined.c.push((()=>{D.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}else o&&o()}function M(t,e,n){const o=t.$$.props[e];void 0!==o&&(t.$$.bound[o]=n,n(t.$$.ctx[o]))}function I(t){t&&t.c()}function P(t,n,a,c){const{fragment:r,on_mount:u,on_destroy:l,after_update:i}=t.$$;r&&r.m(n,a),c||E((()=>{const n=u.map(e).filter(s);l?l.push(...n):o(n),t.$$.on_mount=[]})),i.forEach(E)}function T(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function J(t,e){-1===t.$$.dirty[0]&&(_.push(t),S||(S=!0,F.then(z)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function H(e,s,a,c,r,u,i,f=[-1]){const d=k;y(e);const m=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:r,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(s.context||(d?d.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:s.target||d.$$.root};i&&i(m.root);let g=!1;if(m.ctx=a?a(e,s.props||{},((t,n,...o)=>{const s=o.length?o[0]:n;return m.ctx&&r(m.ctx[t],m.ctx[t]=s)&&(!m.skip_bound&&m.bound[t]&&m.bound[t](s),g&&J(e,t)),n})):[],m.update(),g=!0,o(m.before_update),m.fragment=!!c&&c(m.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);m.fragment&&m.fragment.l(t),t.forEach(l)}else m.fragment&&m.fragment.c();s.intro&&N(e.$$.fragment),P(e,s.target,s.anchor,s.customElement),z()}y(d)}class W{$destroy(){T(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Z(e){let n,o,s,a;return{c(){n=f("button"),o=d(e[2]),p(n,"class","svelte-19loasr"),b(n,"sorted",e[0].field===e[1]),b(n,"reversed",e[0].dir<0)},m(t,c){u(t,n,c),r(n,o),s||(a=g(n,"click",e[3]),s=!0)},p(t,[e]){4&e&&x(o,t[2]),3&e&&b(n,"sorted",t[0].field===t[1]),1&e&&b(n,"reversed",t[0].dir<0)},i:t,o:t,d(t){t&&l(n),s=!1,a()}}}function G(t,e,n){let{method:o,field:s,text:a}=e;return t.$$set=t=>{"method"in t&&n(0,o=t.method),"field"in t&&n(1,s=t.field),"text"in t&&n(2,a=t.text)},[o,s,a,function(){o.field!==s?(n(0,o.field=s,o),n(0,o.dir=1,o)):n(0,o.dir*=-1,o)}]}class K extends W{constructor(t){super(),H(this,t,G,Z,a,{method:0,field:1,text:2})}}var Q=[{name:"加護之劍",cost:3,grade:1,buff:[{atk:250,times:1}]},{name:"小曲刀",cost:2,grade:1,buff:[{atk:50,times:99}],stance:{gain:1}},{name:"平衡劍",cost:3,grade:2,atk:440,modLv:"D",stance:{gain:1}},{name:"騎士長劍",cost:4,grade:2,atk:250,modLv:"B",stance:{use:1,gain:2,bonus:50}},{name:"盜賊短劍",cost:2,grade:2,atk:300,modLv:"E",stance:{gain:1}},{name:"突襲彎刀",cost:4,grade:2,atk:570,modLv:"D"},{name:"神聖之劍",cost:2,grade:2,buff:[{atk:280,times:1}]},{name:"火羽骸蝶",cost:4,grade:4,atk:510,modLv:"A"},{name:"重鐵",cost:5,grade:2,atk:480,modLv:"A"},{name:"狼牙大劍",cost:5,grade:3,atk:200,modLv:"S",stance:{use:2,gain:0,bonus:60}},{name:"追擊彎刀",cost:4,grade:3,atk:500,modLv:"C",stance:{use:1,gain:2,bonus:40}},{name:"俠盜短劍",cost:1,grade:3,atk:620,stance:{gain:1}},{name:"教堂禮劍",cost:3,grade:3,buff:[{atk:480,times:1}],stance:{gain:1}},{name:"破冰刀",cost:6,grade:3,atk:450,modLv:"S",atkBonusOnFreeze:25},{name:"巨型西瓜冰棒",cost:4,grade:4,atk:50,modLv:"S",atkBonusOnFreeze:10},{name:"動力能量劍",cost:4,grade:3,atk:950,modLv:"D",stance:{use:2,gain:0,bonus:80}},{name:"彩虹的指揮棒",cost:2,grade:3,atk:100,modLv:"E",buff:[{atk:300,times:99}]},{name:"暗殺者之劍",cost:3,grade:3,atk:660,modLv:"E",stance:{gain:1},atkBonusOnBack:50},{name:"結晶神聖劍",cost:4,grade:4,buff:[{atk:400,times:1}],stance:{use:1,gain:2,buff:[{atk:300,times:1}]}},{name:"破滅寒冰",cost:4,grade:4,atk:420,modLv:"A"}];const R=[];const U="zoldout-damage-calculator",V=new Map;function X(e,n){if(V.has(e))return V.get(e);const o=function(e,n=t){let o;const s=new Set;function c(t){if(a(e,t)&&(e=t,o)){const t=!R.length;for(const t of s)t[1](),R.push(t,e);if(t){for(let t=0;t<R.length;t+=2)R[t][0](R[t+1]);R.length=0}}}return{set:c,update:function(t){c(t(e))},subscribe:function(a,r=t){const u=[a,r];return s.add(u),1===s.size&&(o=n(c)||t),a(e),()=>{s.delete(u),0===s.size&&(o(),o=null)}}}}(function(t){try{return JSON.parse(t)}catch{}}(localStorage.getItem(`${U}/${e}`))??n);return o.subscribe((t=>localStorage.setItem(`${U}/${e}`,JSON.stringify(t)))),V.set(e,o),o}const Y={F:.85,E:1.1,D:1.35,C:1.6,B:1.85,A:2.1,S:2.35,SS:2.6};function tt(t,e,n){const o=[];let s={atk:t,def:e,stance:0,buff:[]};for(const t of n){const e=et(s,t);s=e.state,o.push(e)}const a=o.reduce(((t,e)=>t+e.damage),0),c=n.reduce(((t,e)=>t+e.cost),0);return{stages:o,summary:{damage:a,cost:c,cp:a/c}}}function et(t,e){const n={atk:t.atk,def:t.def,stance:t.stance,buff:[]};let o=0;if(e.atk||e.modLv){let n=0;if(e.modLv){for(const e of t.buff)n+=e.atk||0;n=(n+t.atk)*Y[e.modLv]}e.atk&&(n+=e.atk);let s=0;e?.stance?.use===t.stance&&(s+=e.stance.bonus||0),o=(n-t.def)*(100+s)/100,o=Math.max(o,1)}if(o)for(const e of t.buff)e.times>1&&n.buff.push({...e,times:e.times-1});else n.buff.push(...t.buff);return e.buff&&n.buff.push(...e.buff),e?.stance?.use===t.stance&&e.stance.buff&&n.buff.push(...e.stance.buff),null!=e?.stance?.gain&&(n.stance=e.stance.gain),{damage:o,state:n}}function nt(t,e,n){const o=t.slice();return o[30]=e[n],o}function ot(t,e,n){const o=t.slice();return o[33]=e[n],o[34]=e,o[35]=n,o}function st(t,e,n){const o=t.slice();return o[36]=e[n],o}function at(e){let n,o,s=e[36].name+"";return{c(){n=f("option"),o=d(s),n.__value=e[36],n.value=n.__value},m(t,e){u(t,n,e),r(n,o)},p:t,d(t){t&&l(n)}}}function ct(t){let e,n,s,a,c,h,$,b,k,y,_,q,C,L,F,S,w,O,A,z,B,D=t[33].cost+"",N=t[1].stages[t[35]]?.damage.toFixed(0)+"",j=((t[1].stages[t[35]]?.damage||0)/t[33].cost).toFixed(0)+"",M=Q,I=[];for(let e=0;e<M.length;e+=1)I[e]=at(st(t,M,e));function P(){t[19].call(e,t[34],t[35])}function T(){return t[20](t[35])}function J(){return t[21](t[35])}function H(){return t[22](t[35])}function W(){return t[23](t[35])}return{c(){e=f("select");for(let t=0;t<I.length;t+=1)I[t].c();n=m(),s=f("span"),a=d(D),c=m(),h=f("span"),$=d(N),b=m(),k=f("span"),y=d(j),_=m(),q=f("div"),C=f("button"),C.textContent="↑",L=m(),F=f("button"),F.textContent="↓",S=m(),w=f("button"),w.textContent="⎘",O=m(),A=f("button"),A.textContent="x",p(e,"class","svelte-1x38q6x"),void 0===t[33]&&E(P),p(s,"class","svelte-1x38q6x"),p(h,"class","svelte-1x38q6x"),p(k,"class","svelte-1x38q6x"),p(q,"class","operation svelte-1x38q6x")},m(o,l){u(o,e,l);for(let t=0;t<I.length;t+=1)I[t].m(e,null);v(e,t[33]),u(o,n,l),u(o,s,l),r(s,a),u(o,c,l),u(o,h,l),r(h,$),u(o,b,l),u(o,k,l),r(k,y),u(o,_,l),u(o,q,l),r(q,C),r(q,L),r(q,F),r(q,S),r(q,w),r(q,O),r(q,A),z||(B=[g(e,"change",P),g(C,"click",T),g(F,"click",J),g(w,"click",H),g(A,"click",W)],z=!0)},p(n,o){if(t=n,0&o){let n;for(M=Q,n=0;n<M.length;n+=1){const s=st(t,M,n);I[n]?I[n].p(s,o):(I[n]=at(s),I[n].c(),I[n].m(e,null))}for(;n<I.length;n+=1)I[n].d(1);I.length=M.length}1&o[0]&&v(e,t[33]),1&o[0]&&D!==(D=t[33].cost+"")&&x(a,D),2&o[0]&&N!==(N=t[1].stages[t[35]]?.damage.toFixed(0)+"")&&x($,N),3&o[0]&&j!==(j=((t[1].stages[t[35]]?.damage||0)/t[33].cost).toFixed(0)+"")&&x(y,j)},d(t){t&&l(e),i(I,t),t&&l(n),t&&l(s),t&&l(c),t&&l(h),t&&l(b),t&&l(k),t&&l(_),t&&l(q),z=!1,o(B)}}}function rt(t){let e,n,o,s,a,c,i,h,$,v,b,k,y,_,q,C=t[30].name+"",L=t[30].cost+"",F=t[30].damage.toFixed(0)+"",S=t[30].cp.toFixed(0)+"";function E(){return t[28](t[30])}return{c(){e=f("span"),n=d(C),o=m(),s=f("span"),a=d(L),c=m(),i=f("span"),h=d(F),$=m(),v=f("span"),b=d(S),k=m(),y=f("button"),y.textContent="x",p(e,"class","svelte-1x38q6x"),p(s,"class","svelte-1x38q6x"),p(i,"class","svelte-1x38q6x"),p(v,"class","svelte-1x38q6x"),p(y,"class","svelte-1x38q6x")},m(t,l){u(t,e,l),r(e,n),u(t,o,l),u(t,s,l),r(s,a),u(t,c,l),u(t,i,l),r(i,h),u(t,$,l),u(t,v,l),r(v,b),u(t,k,l),u(t,y,l),_||(q=g(y,"click",E),_=!0)},p(e,o){t=e,4&o[0]&&C!==(C=t[30].name+"")&&x(n,C),4&o[0]&&L!==(L=t[30].cost+"")&&x(a,L),4&o[0]&&F!==(F=t[30].damage.toFixed(0)+"")&&x(h,F),4&o[0]&&S!==(S=t[30].cp.toFixed(0)+"")&&x(b,S)},d(t){t&&l(e),t&&l(o),t&&l(s),t&&l(c),t&&l(i),t&&l($),t&&l(v),t&&l(k),t&&l(y),_=!1,q()}}}function ut(t){let e,n,s,a,c,v,b,k,y,_,C,L,F,S,E,O,A,z,B,D,J,H,W,Z,G,Q,R,U,V,X,Y,tt,et,st,at,ut,lt,it,ft,dt,mt,gt,pt,ht,xt,$t,vt,bt,kt,yt,_t,qt,Ct,Lt,Ft,St,Et=t[1].summary.cost+"",wt=t[1].summary.damage.toFixed(0)+"",Ot=t[1].summary.cp.toFixed(0)+"",At=t[0],zt=[];for(let e=0;e<At.length;e+=1)zt[e]=ct(ot(t,At,e));function Bt(e){t[24](e)}let Dt={field:"name",text:"Name"};function Nt(e){t[25](e)}void 0!==t[3]&&(Dt.method=t[3]),it=new K({props:Dt}),q.push((()=>M(it,"method",Bt)));let jt={field:"cost",text:"Cost"};function Mt(e){t[26](e)}void 0!==t[3]&&(jt.method=t[3]),mt=new K({props:jt}),q.push((()=>M(mt,"method",Nt)));let It={field:"damage",text:"Damage"};function Pt(e){t[27](e)}void 0!==t[3]&&(It.method=t[3]),ht=new K({props:It}),q.push((()=>M(ht,"method",Mt)));let Tt={field:"cp",text:"CP"};void 0!==t[3]&&(Tt.method=t[3]),vt=new K({props:Tt}),q.push((()=>M(vt,"method",Pt)));let Jt=t[2],Ht=[];for(let e=0;e<Jt.length;e+=1)Ht[e]=rt(nt(t,Jt,e));return{c(){e=f("h1"),e.textContent="Zold:Out Damage Calculator",n=m(),s=f("div"),a=f("span"),a.textContent="力量",c=m(),v=f("input"),b=m(),k=f("span"),k.textContent="防禦",y=m(),_=f("input"),C=m(),L=f("div"),F=f("span"),F.textContent="Weapon",S=m(),E=f("span"),E.textContent="Cost",O=m(),A=f("span"),A.textContent="Damage",z=m(),B=f("span"),B.textContent="CP",D=m(),J=f("span"),H=m();for(let t=0;t<zt.length;t+=1)zt[t].c();W=m(),Z=f("span"),Z.textContent="Summary",G=m(),Q=f("span"),R=d(Et),U=m(),V=f("span"),X=d(wt),Y=m(),tt=f("span"),et=d(Ot),st=m(),at=f("button"),at.textContent="Add to compare list",ut=m(),lt=f("div"),I(it.$$.fragment),dt=m(),I(mt.$$.fragment),pt=m(),I(ht.$$.fragment),$t=m(),I(vt.$$.fragment),kt=m(),yt=f("span"),_t=m();for(let t=0;t<Ht.length;t+=1)Ht[t].c();qt=m(),Ct=f("footer"),Ct.innerHTML='<a href="https://github.com/eight04/zoldout-damage-calculator">zoldout-damage-calculator</a>',p(v,"type","number"),p(_,"type","number"),p(s,"class","base-info svelte-1x38q6x"),p(F,"class","chead svelte-1x38q6x"),p(E,"class","chead svelte-1x38q6x"),p(A,"class","chead svelte-1x38q6x"),p(B,"class","chead svelte-1x38q6x"),p(J,"class","svelte-1x38q6x"),p(Z,"class","chead svelte-1x38q6x"),p(Q,"class","svelte-1x38q6x"),p(V,"class","svelte-1x38q6x"),p(tt,"class","svelte-1x38q6x"),p(L,"class","combo-table svelte-1x38q6x"),p(yt,"class","svelte-1x38q6x"),p(lt,"class","compare-list svelte-1x38q6x"),p(Ct,"class","svelte-1x38q6x")},m(o,l){u(o,e,l),u(o,n,l),u(o,s,l),r(s,a),r(s,c),r(s,v),$(v,t[5]),r(s,b),r(s,k),r(s,y),r(s,_),$(_,t[4]),u(o,C,l),u(o,L,l),r(L,F),r(L,S),r(L,E),r(L,O),r(L,A),r(L,z),r(L,B),r(L,D),r(L,J),r(L,H);for(let t=0;t<zt.length;t+=1)zt[t].m(L,null);r(L,W),r(L,Z),r(L,G),r(L,Q),r(Q,R),r(L,U),r(L,V),r(V,X),r(L,Y),r(L,tt),r(tt,et),u(o,st,l),u(o,at,l),u(o,ut,l),u(o,lt,l),P(it,lt,null),r(lt,dt),P(mt,lt,null),r(lt,pt),P(ht,lt,null),r(lt,$t),P(vt,lt,null),r(lt,kt),r(lt,yt),r(lt,_t);for(let t=0;t<Ht.length;t+=1)Ht[t].m(lt,null);u(o,qt,l),u(o,Ct,l),Lt=!0,Ft||(St=[g(v,"input",t[17]),g(_,"input",t[18]),g(at,"click",t[13])],Ft=!0)},p(t,e){if(32&e[0]&&h(v.value)!==t[5]&&$(v,t[5]),16&e[0]&&h(_.value)!==t[4]&&$(_,t[4]),7171&e[0]){let n;for(At=t[0],n=0;n<At.length;n+=1){const o=ot(t,At,n);zt[n]?zt[n].p(o,e):(zt[n]=ct(o),zt[n].c(),zt[n].m(L,W))}for(;n<zt.length;n+=1)zt[n].d(1);zt.length=At.length}(!Lt||2&e[0])&&Et!==(Et=t[1].summary.cost+"")&&x(R,Et),(!Lt||2&e[0])&&wt!==(wt=t[1].summary.damage.toFixed(0)+"")&&x(X,wt),(!Lt||2&e[0])&&Ot!==(Ot=t[1].summary.cp.toFixed(0)+"")&&x(et,Ot);const n={};!ft&&8&e[0]&&(ft=!0,n.method=t[3],w((()=>ft=!1))),it.$set(n);const o={};!gt&&8&e[0]&&(gt=!0,o.method=t[3],w((()=>gt=!1))),mt.$set(o);const s={};!xt&&8&e[0]&&(xt=!0,s.method=t[3],w((()=>xt=!1))),ht.$set(s);const a={};if(!bt&&8&e[0]&&(bt=!0,a.method=t[3],w((()=>bt=!1))),vt.$set(a),16388&e[0]){let n;for(Jt=t[2],n=0;n<Jt.length;n+=1){const o=nt(t,Jt,n);Ht[n]?Ht[n].p(o,e):(Ht[n]=rt(o),Ht[n].c(),Ht[n].m(lt,null))}for(;n<Ht.length;n+=1)Ht[n].d(1);Ht.length=Jt.length}},i(t){Lt||(N(it.$$.fragment,t),N(mt.$$.fragment,t),N(ht.$$.fragment,t),N(vt.$$.fragment,t),Lt=!0)},o(t){j(it.$$.fragment,t),j(mt.$$.fragment,t),j(ht.$$.fragment,t),j(vt.$$.fragment,t),Lt=!1},d(t){t&&l(e),t&&l(n),t&&l(s),t&&l(C),t&&l(L),i(zt,t),t&&l(st),t&&l(at),t&&l(ut),t&&l(lt),T(it),T(mt),T(ht),T(vt),i(Ht,t),t&&l(qt),t&&l(Ct),Ft=!1,o(St)}}}function lt(t,e,n){let o,s,a,r;const u=Object.fromEntries(Q.map((t=>[t.name,t]))),l=X("atk",700);c(t,l,(t=>n(5,r=t)));const i=X("def",400);c(t,i,(t=>n(4,a=t)));const f=X("compareList",[]);c(t,f,(t=>n(16,o=t)));const d=X("sortMethod",{field:null,dir:1});c(t,d,(t=>n(3,s=t)));let m=[Q[0]],g={stages:[],summary:{damage:0,cost:0,cp:0}},p=[],x=[];function $(t){m.splice(t,0,m[t]),n(0,m)}function v(t){m.length<=1||(m.splice(t,1),n(0,m))}function b(t,e){const o=m[t];m.splice(t,1),m.splice(t+e,0,o),n(0,m)}function k(t){o.splice(t,1),f.set(o)}return t.$$.update=()=>{49&t.$$.dirty[0]&&n(1,g=tt(r,a,m)),65584&t.$$.dirty[0]&&n(15,p=o.map(((t,e)=>{const n=t.map((t=>u[t])),o=tt(r,a,n);return{name:t.join("+"),cost:o.summary.cost,damage:o.summary.damage,cp:o.summary.cp,index:e}}))),32780&t.$$.dirty[0]&&(console.log("sort"),n(2,x=p.slice()),s.field&&x.sort(((t,e)=>(t[s.field]<e[s.field]?-1:t[s.field]>e[s.field]?1:0)*s.dir)))},[m,g,x,s,a,r,l,i,f,d,$,v,b,function(){o.push(m.map((t=>t.name))),f.set(o)},k,p,o,function(){r=h(this.value),l.set(r)},function(){a=h(this.value),i.set(a)},function(t,e){t[e]=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(0,m)},t=>b(t,-1),t=>b(t,1),t=>$(t),t=>v(t),function(t){s=t,d.set(s)},function(t){s=t,d.set(s)},function(t){s=t,d.set(s)},function(t){s=t,d.set(s)},t=>k(t.index)]}return new class extends W{constructor(t){super(),H(this,t,lt,ut,a,{},null,[-1,-1])}}({target:document.body})}();
//# sourceMappingURL=index.js.map
